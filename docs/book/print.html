<!DOCTYPE HTML>
<html lang="en" class="light sidebar-visible" dir="ltr">
    <head>
        <!-- Book generated using mdBook -->
        <meta charset="UTF-8">
        <title>Ankit Documentation</title>
        <meta name="robots" content="noindex">


        <!-- Custom HTML head -->

        <meta name="description" content="">
        <meta name="viewport" content="width=device-width, initial-scale=1">
        <meta name="theme-color" content="#ffffff">

        <link rel="icon" href="favicon-de23e50b.svg">
        <link rel="shortcut icon" href="favicon-8114d1fc.png">
        <link rel="stylesheet" href="css/variables-8adf115d.css">
        <link rel="stylesheet" href="css/general-2459343d.css">
        <link rel="stylesheet" href="css/chrome-ae938929.css">
        <link rel="stylesheet" href="css/print-9e4910d8.css" media="print">

        <!-- Fonts -->
        <link rel="stylesheet" href="fonts/fonts-9644e21d.css">

        <!-- Highlight.js Stylesheets -->
        <link rel="stylesheet" id="mdbook-highlight-css" href="highlight-493f70e1.css">
        <link rel="stylesheet" id="mdbook-tomorrow-night-css" href="tomorrow-night-4c0ae647.css">
        <link rel="stylesheet" id="mdbook-ayu-highlight-css" href="ayu-highlight-3fdfc3ac.css">

        <!-- Custom theme stylesheets -->


        <!-- Provide site root and default themes to javascript -->
        <script>
            const path_to_root = "";
            const default_light_theme = "light";
            const default_dark_theme = "navy";
            window.path_to_searchindex_js = "searchindex-8022d309.js";
        </script>
        <!-- Start loading toc.js asap -->
        <script src="toc-c36837f4.js"></script>
    </head>
    <body>
    <div id="mdbook-help-container">
        <div id="mdbook-help-popup">
            <h2 class="mdbook-help-title">Keyboard shortcuts</h2>
            <div>
                <p>Press <kbd>←</kbd> or <kbd>→</kbd> to navigate between chapters</p>
                <p>Press <kbd>S</kbd> or <kbd>/</kbd> to search in the book</p>
                <p>Press <kbd>?</kbd> to show this help</p>
                <p>Press <kbd>Esc</kbd> to hide this help</p>
            </div>
        </div>
    </div>
    <div id="mdbook-body-container">
        <!-- Work around some values being stored in localStorage wrapped in quotes -->
        <script>
            try {
                let theme = localStorage.getItem('mdbook-theme');
                let sidebar = localStorage.getItem('mdbook-sidebar');

                if (theme.startsWith('"') && theme.endsWith('"')) {
                    localStorage.setItem('mdbook-theme', theme.slice(1, theme.length - 1));
                }

                if (sidebar.startsWith('"') && sidebar.endsWith('"')) {
                    localStorage.setItem('mdbook-sidebar', sidebar.slice(1, sidebar.length - 1));
                }
            } catch (e) { }
        </script>

        <!-- Set the theme before any content is loaded, prevents flash -->
        <script>
            const default_theme = window.matchMedia("(prefers-color-scheme: dark)").matches ? default_dark_theme : default_light_theme;
            let theme;
            try { theme = localStorage.getItem('mdbook-theme'); } catch(e) { }
            if (theme === null || theme === undefined) { theme = default_theme; }
            const html = document.documentElement;
            html.classList.remove('light')
            html.classList.add(theme);
            html.classList.add("js");
        </script>

        <input type="checkbox" id="mdbook-sidebar-toggle-anchor" class="hidden">

        <!-- Hide / unhide sidebar before it is displayed -->
        <script>
            let sidebar = null;
            const sidebar_toggle = document.getElementById("mdbook-sidebar-toggle-anchor");
            if (document.body.clientWidth >= 1080) {
                try { sidebar = localStorage.getItem('mdbook-sidebar'); } catch(e) { }
                sidebar = sidebar || 'visible';
            } else {
                sidebar = 'hidden';
                sidebar_toggle.checked = false;
            }
            if (sidebar === 'visible') {
                sidebar_toggle.checked = true;
            } else {
                html.classList.remove('sidebar-visible');
            }
        </script>

        <nav id="mdbook-sidebar" class="sidebar" aria-label="Table of contents">
            <!-- populated by js -->
            <mdbook-sidebar-scrollbox class="sidebar-scrollbox"></mdbook-sidebar-scrollbox>
            <noscript>
                <iframe class="sidebar-iframe-outer" src="toc.html"></iframe>
            </noscript>
            <div id="mdbook-sidebar-resize-handle" class="sidebar-resize-handle">
                <div class="sidebar-resize-indicator"></div>
            </div>
        </nav>

        <div id="mdbook-page-wrapper" class="page-wrapper">

            <div class="page">
                <div id="mdbook-menu-bar-hover-placeholder"></div>
                <div id="mdbook-menu-bar" class="menu-bar sticky">
                    <div class="left-buttons">
                        <label id="mdbook-sidebar-toggle" class="icon-button" for="mdbook-sidebar-toggle-anchor" title="Toggle Table of Contents" aria-label="Toggle Table of Contents" aria-controls="mdbook-sidebar">
                            <span class=fa-svg><svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 448 512"><!--! Font Awesome Free 6.2.0 by @fontawesome - https://fontawesome.com License - https://fontawesome.com/license/free (Icons: CC BY 4.0, Fonts: SIL OFL 1.1, Code: MIT License) Copyright 2022 Fonticons, Inc. --><path d="M0 96C0 78.3 14.3 64 32 64H416c17.7 0 32 14.3 32 32s-14.3 32-32 32H32C14.3 128 0 113.7 0 96zM0 256c0-17.7 14.3-32 32-32H416c17.7 0 32 14.3 32 32s-14.3 32-32 32H32c-17.7 0-32-14.3-32-32zM448 416c0 17.7-14.3 32-32 32H32c-17.7 0-32-14.3-32-32s14.3-32 32-32H416c17.7 0 32 14.3 32 32z"/></svg></span>
                        </label>
                        <button id="mdbook-theme-toggle" class="icon-button" type="button" title="Change theme" aria-label="Change theme" aria-haspopup="true" aria-expanded="false" aria-controls="mdbook-theme-list">
                            <span class=fa-svg><svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 576 512"><!--! Font Awesome Free 6.2.0 by @fontawesome - https://fontawesome.com License - https://fontawesome.com/license/free (Icons: CC BY 4.0, Fonts: SIL OFL 1.1, Code: MIT License) Copyright 2022 Fonticons, Inc. --><path d="M371.3 367.1c27.3-3.9 51.9-19.4 67.2-42.9L600.2 74.1c12.6-19.5 9.4-45.3-7.6-61.2S549.7-4.4 531.1 9.6L294.4 187.2c-24 18-38.2 46.1-38.4 76.1L371.3 367.1zm-19.6 25.4l-116-104.4C175.9 290.3 128 339.6 128 400c0 3.9 .2 7.8 .6 11.6c1.8 17.5-10.2 36.4-27.8 36.4H96c-17.7 0-32 14.3-32 32s14.3 32 32 32H240c61.9 0 112-50.1 112-112c0-2.5-.1-5-.2-7.5z"/></svg></span>
                        </button>
                        <ul id="mdbook-theme-list" class="theme-popup" aria-label="Themes" role="menu">
                            <li role="none"><button role="menuitem" class="theme" id="mdbook-theme-default_theme">Auto</button></li>
                            <li role="none"><button role="menuitem" class="theme" id="mdbook-theme-light">Light</button></li>
                            <li role="none"><button role="menuitem" class="theme" id="mdbook-theme-rust">Rust</button></li>
                            <li role="none"><button role="menuitem" class="theme" id="mdbook-theme-coal">Coal</button></li>
                            <li role="none"><button role="menuitem" class="theme" id="mdbook-theme-navy">Navy</button></li>
                            <li role="none"><button role="menuitem" class="theme" id="mdbook-theme-ayu">Ayu</button></li>
                        </ul>
                        <button id="mdbook-search-toggle" class="icon-button" type="button" title="Search (`/`)" aria-label="Toggle Searchbar" aria-expanded="false" aria-keyshortcuts="/ s" aria-controls="mdbook-searchbar">
                            <span class=fa-svg><svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 512 512"><!--! Font Awesome Free 6.2.0 by @fontawesome - https://fontawesome.com License - https://fontawesome.com/license/free (Icons: CC BY 4.0, Fonts: SIL OFL 1.1, Code: MIT License) Copyright 2022 Fonticons, Inc. --><path d="M416 208c0 45.9-14.9 88.3-40 122.7L502.6 457.4c12.5 12.5 12.5 32.8 0 45.3s-32.8 12.5-45.3 0L330.7 376c-34.4 25.2-76.8 40-122.7 40C93.1 416 0 322.9 0 208S93.1 0 208 0S416 93.1 416 208zM208 352c79.5 0 144-64.5 144-144s-64.5-144-144-144S64 128.5 64 208s64.5 144 144 144z"/></svg></span>
                        </button>
                    </div>

                    <h1 class="menu-title">Ankit Documentation</h1>

                    <div class="right-buttons">
                        <a href="print.html" title="Print this book" aria-label="Print this book">
                            <span class=fa-svg id="print-button"><svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 512 512"><!--! Font Awesome Free 6.2.0 by @fontawesome - https://fontawesome.com License - https://fontawesome.com/license/free (Icons: CC BY 4.0, Fonts: SIL OFL 1.1, Code: MIT License) Copyright 2022 Fonticons, Inc. --><path d="M128 0C92.7 0 64 28.7 64 64v96h64V64H354.7L384 93.3V160h64V93.3c0-17-6.7-33.3-18.7-45.3L400 18.7C388 6.7 371.7 0 354.7 0H128zM384 352v32 64H128V384 368 352H384zm64 32h32c17.7 0 32-14.3 32-32V256c0-35.3-28.7-64-64-64H64c-35.3 0-64 28.7-64 64v96c0 17.7 14.3 32 32 32H64v64c0 35.3 28.7 64 64 64H384c35.3 0 64-28.7 64-64V384zm-16-88c-13.3 0-24-10.7-24-24s10.7-24 24-24s24 10.7 24 24s-10.7 24-24 24z"/></svg></span>
                        </a>
                        <a href="https://github.com/joshrotenberg/ankit" title="Git repository" aria-label="Git repository">
                            <span class=fa-svg><svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 496 512"><!--! Font Awesome Free 6.2.0 by @fontawesome - https://fontawesome.com License - https://fontawesome.com/license/free (Icons: CC BY 4.0, Fonts: SIL OFL 1.1, Code: MIT License) Copyright 2022 Fonticons, Inc. --><path d="M165.9 397.4c0 2-2.3 3.6-5.2 3.6-3.3.3-5.6-1.3-5.6-3.6 0-2 2.3-3.6 5.2-3.6 3-.3 5.6 1.3 5.6 3.6zm-31.1-4.5c-.7 2 1.3 4.3 4.3 4.9 2.6 1 5.6 0 6.2-2s-1.3-4.3-4.3-5.2c-2.6-.7-5.5.3-6.2 2.3zm44.2-1.7c-2.9.7-4.9 2.6-4.6 4.9.3 2 2.9 3.3 5.9 2.6 2.9-.7 4.9-2.6 4.6-4.6-.3-1.9-3-3.2-5.9-2.9zM244.8 8C106.1 8 0 113.3 0 252c0 110.9 69.8 205.8 169.5 239.2 12.8 2.3 17.3-5.6 17.3-12.1 0-6.2-.3-40.4-.3-61.4 0 0-70 15-84.7-29.8 0 0-11.4-29.1-27.8-36.6 0 0-22.9-15.7 1.6-15.4 0 0 24.9 2 38.6 25.8 21.9 38.6 58.6 27.5 72.9 20.9 2.3-16 8.8-27.1 16-33.7-55.9-6.2-112.3-14.3-112.3-110.5 0-27.5 7.6-41.3 23.6-58.9-2.6-6.5-11.1-33.3 2.6-67.9 20.9-6.5 69 27 69 27 20-5.6 41.5-8.5 62.8-8.5s42.8 2.9 62.8 8.5c0 0 48.1-33.6 69-27 13.7 34.7 5.2 61.4 2.6 67.9 16 17.7 25.8 31.5 25.8 58.9 0 96.5-58.9 104.2-114.8 110.5 9.2 7.9 17 22.9 17 46.4 0 33.7-.3 75.4-.3 83.6 0 6.5 4.6 14.4 17.3 12.1C428.2 457.8 496 362.9 496 252 496 113.3 383.5 8 244.8 8zM97.2 352.9c-1.3 1-1 3.3.7 5.2 1.6 1.6 3.9 2.3 5.2 1 1.3-1 1-3.3-.7-5.2-1.6-1.6-3.9-2.3-5.2-1zm-10.8-8.1c-.7 1.3.3 2.9 2.3 3.9 1.6 1 3.6.7 4.3-.7.7-1.3-.3-2.9-2.3-3.9-2-.6-3.6-.3-4.3.7zm32.4 35.6c-1.6 1.3-1 4.3 1.3 6.2 2.3 2.3 5.2 2.6 6.5 1 1.3-1.3.7-4.3-1.3-6.2-2.2-2.3-5.2-2.6-6.5-1zm-11.4-14.7c-1.6 1-1.6 3.6 0 5.9 1.6 2.3 4.3 3.3 5.6 2.3 1.6-1.3 1.6-3.9 0-6.2-1.4-2.3-4-3.3-5.6-2z"/></svg></span>
                        </a>

                    </div>
                </div>

                <div id="mdbook-search-wrapper" class="hidden">
                    <form id="mdbook-searchbar-outer" class="searchbar-outer">
                        <div class="search-wrapper">
                            <input type="search" id="mdbook-searchbar" name="searchbar" placeholder="Search this book ..." aria-controls="mdbook-searchresults-outer" aria-describedby="searchresults-header">
                            <div class="spinner-wrapper">
                                <span class=fa-svg id="fa-spin"><svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 512 512"><!--! Font Awesome Free 6.2.0 by @fontawesome - https://fontawesome.com License - https://fontawesome.com/license/free (Icons: CC BY 4.0, Fonts: SIL OFL 1.1, Code: MIT License) Copyright 2022 Fonticons, Inc. --><path d="M304 48c0-26.5-21.5-48-48-48s-48 21.5-48 48s21.5 48 48 48s48-21.5 48-48zm0 416c0-26.5-21.5-48-48-48s-48 21.5-48 48s21.5 48 48 48s48-21.5 48-48zM48 304c26.5 0 48-21.5 48-48s-21.5-48-48-48s-48 21.5-48 48s21.5 48 48 48zm464-48c0-26.5-21.5-48-48-48s-48 21.5-48 48s21.5 48 48 48s48-21.5 48-48zM142.9 437c18.7-18.7 18.7-49.1 0-67.9s-49.1-18.7-67.9 0s-18.7 49.1 0 67.9s49.1 18.7 67.9 0zm0-294.2c18.7-18.7 18.7-49.1 0-67.9S93.7 56.2 75 75s-18.7 49.1 0 67.9s49.1 18.7 67.9 0zM369.1 437c18.7 18.7 49.1 18.7 67.9 0s18.7-49.1 0-67.9s-49.1-18.7-67.9 0s-18.7 49.1 0 67.9z"/></svg></span>
                            </div>
                        </div>
                    </form>
                    <div id="mdbook-searchresults-outer" class="searchresults-outer hidden">
                        <div id="mdbook-searchresults-header" class="searchresults-header"></div>
                        <ul id="mdbook-searchresults">
                        </ul>
                    </div>
                </div>

                <!-- Apply ARIA attributes after the sidebar and the sidebar toggle button are added to the DOM -->
                <script>
                    document.getElementById('mdbook-sidebar-toggle').setAttribute('aria-expanded', sidebar === 'visible');
                    document.getElementById('mdbook-sidebar').setAttribute('aria-hidden', sidebar !== 'visible');
                    Array.from(document.querySelectorAll('#mdbook-sidebar a')).forEach(function(link) {
                        link.setAttribute('tabIndex', sidebar === 'visible' ? 0 : -1);
                    });
                </script>

                <div id="mdbook-content" class="content">
                    <main>
                        <h1 id="introduction"><a class="header" href="#introduction">Introduction</a></h1>
<p><strong>Ankit</strong> is a Rust toolkit for Anki deck management via AnkiConnect. It provides a comprehensive set of tools for working with Anki flashcards programmatically.</p>
<h2 id="components"><a class="header" href="#components">Components</a></h2>
<p>The project consists of four crates:</p>
<h3 id="ankit-core-client"><a class="header" href="#ankit-core-client">ankit (Core Client)</a></h3>
<p>A 1:1 mapping to the AnkiConnect API with 106 methods. Provides typed access to all AnkiConnect operations.</p>
<pre><code class="language-rust ignore">use ankit::AnkiClient;

let client = AnkiClient::new();
let decks = client.decks().names().await?;</code></pre>
<h3 id="ankit-engine-workflows"><a class="header" href="#ankit-engine-workflows">ankit-engine (Workflows)</a></h3>
<p>High-level workflow operations that combine multiple API calls into cohesive actions:</p>
<ul>
<li><strong>Import/Export</strong>: Bulk import with duplicate handling, deck export</li>
<li><strong>Analyze</strong>: Study statistics, problem card detection, retention analysis</li>
<li><strong>Organize</strong>: Deck cloning, merging, tag-based reorganization</li>
<li><strong>Progress</strong>: Card state management, performance tagging</li>
<li><strong>Media</strong>: Audit and cleanup orphaned files</li>
<li><strong>Enrich</strong>: Find and update notes with empty fields</li>
<li><strong>Deduplicate</strong>: Find and remove duplicate notes</li>
</ul>
<h3 id="ankit-mcp-mcp-server"><a class="header" href="#ankit-mcp-mcp-server">ankit-mcp (MCP Server)</a></h3>
<p>A Model Context Protocol server exposing 46 tools for AI assistant integration. Works with Claude Desktop, VS Code, and other MCP clients.</p>
<h3 id="ankit-builder-deck-builder"><a class="header" href="#ankit-builder-deck-builder">ankit-builder (Deck Builder)</a></h3>
<p>TOML-based deck builder with dual output:</p>
<ul>
<li>Generate <code>.apkg</code> files for direct import into Anki</li>
<li>Import directly via AnkiConnect to a running Anki instance</li>
</ul>
<h2 id="requirements"><a class="header" href="#requirements">Requirements</a></h2>
<ul>
<li>Anki desktop application</li>
<li><a href="https://foosoft.net/projects/anki-connect/">AnkiConnect</a> add-on installed</li>
<li>Rust 2024 edition (for development)</li>
</ul>
<h2 id="quick-links"><a class="header" href="#quick-links">Quick Links</a></h2>
<ul>
<li><a href="https://github.com/joshrotenberg/ankit">GitHub Repository</a></li>
<li><a href="https://docs.rs/ankit">API Documentation</a></li>
<li><a href="https://foosoft.net/projects/anki-connect/">AnkiConnect Documentation</a></li>
</ul>
<div style="break-before: page; page-break-before: always;"></div>
<h1 id="installation"><a class="header" href="#installation">Installation</a></h1>
<h2 id="prerequisites"><a class="header" href="#prerequisites">Prerequisites</a></h2>
<ol>
<li>
<p><strong>Anki Desktop</strong>: Download from <a href="https://apps.ankiweb.net/">apps.ankiweb.net</a></p>
</li>
<li>
<p><strong>AnkiConnect Add-on</strong>: Install from within Anki:</p>
<ul>
<li>Tools &gt; Add-ons &gt; Get Add-ons</li>
<li>Enter code: <code>2055492159</code></li>
<li>Restart Anki</li>
</ul>
</li>
</ol>
<h2 id="installing-ankit-crates"><a class="header" href="#installing-ankit-crates">Installing Ankit Crates</a></h2>
<p>Add the crates you need to your <code>Cargo.toml</code>:</p>
<h3 id="core-client-only"><a class="header" href="#core-client-only">Core Client Only</a></h3>
<pre><code class="language-toml">[dependencies]
ankit = "0.1"
</code></pre>
<h3 id="with-engine-workflows"><a class="header" href="#with-engine-workflows">With Engine Workflows</a></h3>
<pre><code class="language-toml">[dependencies]
ankit-engine = "0.1"
</code></pre>
<h3 id="deck-builder"><a class="header" href="#deck-builder">Deck Builder</a></h3>
<pre><code class="language-toml">[dependencies]
ankit-builder = "0.1"
</code></pre>
<h2 id="feature-flags"><a class="header" href="#feature-flags">Feature Flags</a></h2>
<h3 id="ankit-engine"><a class="header" href="#ankit-engine">ankit-engine</a></h3>
<p>All features are enabled by default. To use only specific workflows:</p>
<pre><code class="language-toml">[dependencies]
ankit-engine = { version = "0.1", default-features = false, features = ["analyze", "import"] }
</code></pre>
<p>Available features:</p>
<ul>
<li><code>import</code> - Bulk import with duplicate handling</li>
<li><code>export</code> - Deck and review history export</li>
<li><code>organize</code> - Deck cloning, merging, reorganization</li>
<li><code>analyze</code> - Study statistics and problem detection</li>
<li><code>migrate</code> - Note type migration</li>
<li><code>media</code> - Media audit and cleanup</li>
<li><code>progress</code> - Card state management</li>
<li><code>enrich</code> - Note enrichment workflows</li>
<li><code>deduplicate</code> - Duplicate detection and removal</li>
</ul>
<h3 id="ankit-builder"><a class="header" href="#ankit-builder">ankit-builder</a></h3>
<pre><code class="language-toml">[dependencies]
ankit-builder = { version = "0.1", default-features = false, features = ["apkg"] }
</code></pre>
<p>Available features:</p>
<ul>
<li><code>apkg</code> (default) - Generate <code>.apkg</code> files</li>
<li><code>connect</code> (default) - AnkiConnect import</li>
</ul>
<h2 id="mcp-server-installation"><a class="header" href="#mcp-server-installation">MCP Server Installation</a></h2>
<p>The MCP server is distributed as a binary. Install with Cargo:</p>
<pre><code class="language-bash">cargo install ankit-mcp
</code></pre>
<p>Or build from source:</p>
<pre><code class="language-bash">git clone https://github.com/joshrotenberg/ankit
cd ankit
cargo build --release -p ankit-mcp
</code></pre>
<h2 id="verifying-installation"><a class="header" href="#verifying-installation">Verifying Installation</a></h2>
<p>Ensure Anki is running with AnkiConnect, then:</p>
<pre><code class="language-rust ignore">use ankit::AnkiClient;

#[tokio::main]
async fn main() -&gt; ankit::Result&lt;()&gt; {
    let client = AnkiClient::new();
    let version = client.misc().version().await?;
    println!("AnkiConnect version: {}", version);
    Ok(())
}</code></pre>
<div style="break-before: page; page-break-before: always;"></div>
<h1 id="quick-start"><a class="header" href="#quick-start">Quick Start</a></h1>
<p>This guide walks through common operations with the ankit library.</p>
<h2 id="connect-to-anki"><a class="header" href="#connect-to-anki">Connect to Anki</a></h2>
<pre><code class="language-rust ignore">use ankit::AnkiClient;

#[tokio::main]
async fn main() -&gt; ankit::Result&lt;()&gt; {
    // Create client with default settings (localhost:8765)
    let client = AnkiClient::new();

    // Verify connection
    let version = client.misc().version().await?;
    println!("Connected to AnkiConnect v{}", version);

    Ok(())
}</code></pre>
<h2 id="list-decks"><a class="header" href="#list-decks">List Decks</a></h2>
<pre><code class="language-rust ignore">let decks = client.decks().names().await?;
for deck in decks {
    println!("- {}", deck);
}</code></pre>
<h2 id="add-a-note"><a class="header" href="#add-a-note">Add a Note</a></h2>
<pre><code class="language-rust ignore">use ankit::NoteBuilder;

let note = NoteBuilder::new("My Deck", "Basic")
    .field("Front", "What is the capital of France?")
    .field("Back", "Paris")
    .tag("geography")
    .tag("europe")
    .build();

let note_id = client.notes().add(note).await?;
println!("Created note: {}", note_id);</code></pre>
<h2 id="find-and-update-notes"><a class="header" href="#find-and-update-notes">Find and Update Notes</a></h2>
<pre><code class="language-rust ignore">use std::collections::HashMap;

// Find notes with a specific tag
let note_ids = client.notes().find("tag:geography").await?;

// Get note details
let notes = client.notes().info(&amp;note_ids).await?;

// Update a note's fields
let mut fields = HashMap::new();
fields.insert("Back".to_string(), "Paris, France".to_string());
client.notes().update_fields(note_ids[0], &amp;fields).await?;</code></pre>
<h2 id="using-the-engine-for-workflows"><a class="header" href="#using-the-engine-for-workflows">Using the Engine for Workflows</a></h2>
<pre><code class="language-rust ignore">use ankit_engine::Engine;

let engine = Engine::new();

// Get study summary for the last 30 days
let stats = engine.analyze().study_summary("Japanese", 30).await?;
println!("Total reviews: {}", stats.total_reviews);
println!("Average per day: {:.1}", stats.avg_reviews_per_day);

// Find problem cards (leeches)
use ankit_engine::analyze::ProblemCriteria;

let criteria = ProblemCriteria {
    min_lapses: 5,
    ..Default::default()
};
let problems = engine.analyze().find_problems("deck:Japanese", criteria).await?;

for card in problems {
    println!("Leech: {} ({} lapses)", card.front, card.lapses);
}</code></pre>
<h2 id="build-a-deck-from-toml"><a class="header" href="#build-a-deck-from-toml">Build a Deck from TOML</a></h2>
<pre><code class="language-rust ignore">use ankit_builder::DeckBuilder;

let toml = r#"
[package]
name = "Vocabulary"
version = "1.0.0"

[[models]]
name = "Basic"
fields = ["Front", "Back"]

[[models.templates]]
name = "Card 1"
front = "{{Front}}"
back = "{{FrontSide}}&lt;hr&gt;{{Back}}"

[[decks]]
name = "Vocabulary"

[[notes]]
deck = "Vocabulary"
model = "Basic"

[notes.fields]
Front = "Hello"
Back = "World"
"#;

let builder = DeckBuilder::parse(toml)?;

// Generate .apkg file
builder.write_apkg("vocabulary.apkg")?;

// Or import directly to Anki
let result = builder.import_connect().await?;
println!("Created {} notes", result.notes_created);</code></pre>
<h2 id="error-handling"><a class="header" href="#error-handling">Error Handling</a></h2>
<pre><code class="language-rust ignore">use ankit::{AnkiClient, Error};

let client = AnkiClient::new();

match client.decks().names().await {
    Ok(decks) =&gt; println!("Found {} decks", decks.len()),
    Err(Error::ConnectionRefused) =&gt; {
        eprintln!("Is Anki running with AnkiConnect?");
    }
    Err(Error::PermissionDenied) =&gt; {
        eprintln!("Check your API key configuration");
    }
    Err(e) =&gt; eprintln!("Error: {}", e),
}</code></pre>
<div style="break-before: page; page-break-before: always;"></div>
<h1 id="mcp-server-setup"><a class="header" href="#mcp-server-setup">MCP Server Setup</a></h1>
<p>The ankit-mcp server exposes Anki operations as MCP tools for AI assistant integration.</p>
<h2 id="installation-1"><a class="header" href="#installation-1">Installation</a></h2>
<pre><code class="language-bash">cargo install ankit-mcp
</code></pre>
<h2 id="configuration"><a class="header" href="#configuration">Configuration</a></h2>
<h3 id="claude-desktop"><a class="header" href="#claude-desktop">Claude Desktop</a></h3>
<p>Add to your Claude Desktop configuration (<code>~/Library/Application Support/Claude/claude_desktop_config.json</code> on macOS):</p>
<pre><code class="language-json">{
  "mcpServers": {
    "anki": {
      "command": "ankit-mcp",
      "args": []
    }
  }
}
</code></pre>
<h3 id="with-custom-settings"><a class="header" href="#with-custom-settings">With Custom Settings</a></h3>
<pre><code class="language-json">{
  "mcpServers": {
    "anki": {
      "command": "ankit-mcp",
      "args": ["--port", "8765", "--read-only"]
    }
  }
}
</code></pre>
<h2 id="command-line-options"><a class="header" href="#command-line-options">Command Line Options</a></h2>
<pre><code>ankit-mcp [OPTIONS]

Options:
    --host &lt;HOST&gt;     AnkiConnect host [default: 127.0.0.1]
    --port &lt;PORT&gt;     AnkiConnect port [default: 8765]
    --read-only       Disable write operations
    -v, --verbose     Logging level (-v=info, -vv=debug, -vvv=trace)
</code></pre>
<h3 id="read-only-mode"><a class="header" href="#read-only-mode">Read-Only Mode</a></h3>
<p>Use <code>--read-only</code> to disable all write operations. This is useful for:</p>
<ul>
<li>Exploring decks without risk of modification</li>
<li>Shared environments where write access should be restricted</li>
<li>Demo and presentation scenarios</li>
</ul>
<h2 id="verification"><a class="header" href="#verification">Verification</a></h2>
<p>After restarting Claude Desktop:</p>
<ol>
<li>Open a conversation</li>
<li>Ask Claude to check the Anki connection:
<pre><code>Can you check if Anki is running by getting the AnkiConnect version?
</code></pre>
</li>
</ol>
<p>Claude will use the <code>version</code> tool to verify connectivity.</p>
<h2 id="troubleshooting"><a class="header" href="#troubleshooting">Troubleshooting</a></h2>
<h3 id="connection-refused-errors"><a class="header" href="#connection-refused-errors">“Connection refused” errors</a></h3>
<ol>
<li>Ensure Anki is running</li>
<li>Verify AnkiConnect add-on is installed (code: 2055492159)</li>
<li>Check if another application is using port 8765</li>
<li>Try specifying the host explicitly: <code>--host 127.0.0.1</code></li>
</ol>
<h3 id="permission-denied-errors"><a class="header" href="#permission-denied-errors">“Permission denied” errors</a></h3>
<ol>
<li>Check AnkiConnect’s allowed origins in Anki’s add-on settings</li>
<li>If using an API key, ensure it’s configured correctly</li>
</ol>
<h3 id="tools-not-appearing"><a class="header" href="#tools-not-appearing">Tools not appearing</a></h3>
<ol>
<li>Restart Claude Desktop after configuration changes</li>
<li>Check the MCP server logs with <code>-vv</code> for debug output</li>
<li>Verify the binary path is correct and executable</li>
</ol>
<div style="break-before: page; page-break-before: always;"></div>
<h1 id="tools-reference"><a class="header" href="#tools-reference">Tools Reference</a></h1>
<p>The MCP server exposes 46 tools organized into categories.</p>
<h2 id="raw-api---notes"><a class="header" href="#raw-api---notes">Raw API - Notes</a></h2>
<div class="table-wrapper">
<table>
<thead>
<tr><th>Tool</th><th>Description</th><th>Write</th></tr>
</thead>
<tbody>
<tr><td><code>add_note</code></td><td>Add single flashcard</td><td>Yes</td></tr>
<tr><td><code>find_notes</code></td><td>Search notes by query</td><td>No</td></tr>
<tr><td><code>get_notes_info</code></td><td>Get note details</td><td>No</td></tr>
<tr><td><code>update_note</code></td><td>Update note fields</td><td>Yes</td></tr>
<tr><td><code>delete_notes</code></td><td>Delete notes</td><td>Yes</td></tr>
</tbody>
</table>
</div>
<h2 id="raw-api---cards"><a class="header" href="#raw-api---cards">Raw API - Cards</a></h2>
<div class="table-wrapper">
<table>
<thead>
<tr><th>Tool</th><th>Description</th><th>Write</th></tr>
</thead>
<tbody>
<tr><td><code>find_cards</code></td><td>Search cards by query</td><td>No</td></tr>
<tr><td><code>get_cards_info</code></td><td>Full card details (reps, lapses, ease, interval)</td><td>No</td></tr>
<tr><td><code>suspend_cards</code></td><td>Suspend cards from reviews</td><td>Yes</td></tr>
<tr><td><code>unsuspend_cards</code></td><td>Unsuspend cards</td><td>Yes</td></tr>
<tr><td><code>forget_cards</code></td><td>Reset cards to new state</td><td>Yes</td></tr>
<tr><td><code>set_ease</code></td><td>Adjust ease factors</td><td>Yes</td></tr>
</tbody>
</table>
</div>
<h2 id="raw-api---tags"><a class="header" href="#raw-api---tags">Raw API - Tags</a></h2>
<div class="table-wrapper">
<table>
<thead>
<tr><th>Tool</th><th>Description</th><th>Write</th></tr>
</thead>
<tbody>
<tr><td><code>add_tags</code></td><td>Add tags to notes</td><td>Yes</td></tr>
<tr><td><code>remove_tags</code></td><td>Remove tags from notes</td><td>Yes</td></tr>
<tr><td><code>replace_tags_all</code></td><td>Rename tag globally</td><td>Yes</td></tr>
<tr><td><code>clear_unused_tags</code></td><td>Cleanup orphaned tags</td><td>Yes</td></tr>
</tbody>
</table>
</div>
<h2 id="raw-api---decksmodelsmisc"><a class="header" href="#raw-api---decksmodelsmisc">Raw API - Decks/Models/Misc</a></h2>
<div class="table-wrapper">
<table>
<thead>
<tr><th>Tool</th><th>Description</th><th>Write</th></tr>
</thead>
<tbody>
<tr><td><code>list_decks</code></td><td>List all decks</td><td>No</td></tr>
<tr><td><code>create_deck</code></td><td>Create new deck</td><td>Yes</td></tr>
<tr><td><code>delete_deck</code></td><td>Delete deck</td><td>Yes</td></tr>
<tr><td><code>list_models</code></td><td>List note types</td><td>No</td></tr>
<tr><td><code>get_model_fields</code></td><td>Get model field names</td><td>No</td></tr>
<tr><td><code>sync</code></td><td>Sync with AnkiWeb</td><td>Yes</td></tr>
<tr><td><code>version</code></td><td>Get AnkiConnect version</td><td>No</td></tr>
</tbody>
</table>
</div>
<h2 id="engine-workflows---importexport"><a class="header" href="#engine-workflows---importexport">Engine Workflows - Import/Export</a></h2>
<div class="table-wrapper">
<table>
<thead>
<tr><th>Tool</th><th>Description</th><th>Write</th></tr>
</thead>
<tbody>
<tr><td><code>import_notes</code></td><td>Bulk import with duplicate handling</td><td>Yes</td></tr>
<tr><td><code>validate_notes</code></td><td>Validate notes before import</td><td>No</td></tr>
<tr><td><code>export_deck</code></td><td>Export deck as JSON</td><td>No</td></tr>
<tr><td><code>export_reviews</code></td><td>Export review history</td><td>No</td></tr>
</tbody>
</table>
</div>
<h2 id="engine-workflows---organize"><a class="header" href="#engine-workflows---organize">Engine Workflows - Organize</a></h2>
<div class="table-wrapper">
<table>
<thead>
<tr><th>Tool</th><th>Description</th><th>Write</th></tr>
</thead>
<tbody>
<tr><td><code>clone_deck</code></td><td>Clone deck with notes</td><td>Yes</td></tr>
<tr><td><code>merge_decks</code></td><td>Merge multiple decks</td><td>Yes</td></tr>
<tr><td><code>move_by_tag</code></td><td>Move notes by tag</td><td>Yes</td></tr>
</tbody>
</table>
</div>
<h2 id="engine-workflows---analyze"><a class="header" href="#engine-workflows---analyze">Engine Workflows - Analyze</a></h2>
<div class="table-wrapper">
<table>
<thead>
<tr><th>Tool</th><th>Description</th><th>Write</th></tr>
</thead>
<tbody>
<tr><td><code>study_summary</code></td><td>Study statistics</td><td>No</td></tr>
<tr><td><code>find_problems</code></td><td>Find leech cards</td><td>No</td></tr>
<tr><td><code>retention_stats</code></td><td>Retention statistics</td><td>No</td></tr>
</tbody>
</table>
</div>
<h2 id="engine-workflows---media"><a class="header" href="#engine-workflows---media">Engine Workflows - Media</a></h2>
<div class="table-wrapper">
<table>
<thead>
<tr><th>Tool</th><th>Description</th><th>Write</th></tr>
</thead>
<tbody>
<tr><td><code>audit_media</code></td><td>Find orphaned media</td><td>No</td></tr>
<tr><td><code>cleanup_media</code></td><td>Delete orphaned media</td><td>Yes</td></tr>
</tbody>
</table>
</div>
<h2 id="engine-workflows---progress"><a class="header" href="#engine-workflows---progress">Engine Workflows - Progress</a></h2>
<div class="table-wrapper">
<table>
<thead>
<tr><th>Tool</th><th>Description</th><th>Write</th></tr>
</thead>
<tbody>
<tr><td><code>reset_deck_progress</code></td><td>Reset all cards to new state</td><td>Yes</td></tr>
<tr><td><code>tag_by_performance</code></td><td>Auto-tag struggling/mastered cards</td><td>Yes</td></tr>
<tr><td><code>suspend_by_criteria</code></td><td>Suspend cards matching criteria</td><td>Yes</td></tr>
<tr><td><code>deck_health_report</code></td><td>Comprehensive deck analysis</td><td>No</td></tr>
<tr><td><code>bulk_tag_operation</code></td><td>Bulk add/remove/replace tags</td><td>Yes</td></tr>
</tbody>
</table>
</div>
<h2 id="query-syntax"><a class="header" href="#query-syntax">Query Syntax</a></h2>
<p>Many tools accept an Anki search query. Common patterns:</p>
<pre><code>deck:Japanese           # Cards in Japanese deck
tag:verb                # Notes with verb tag
is:due                  # Due cards
is:new                  # New cards
is:review               # Review cards
is:suspended            # Suspended cards
rated:7                 # Reviewed in last 7 days
prop:lapses&gt;=5          # Cards with 5+ lapses
prop:ease&lt;2             # Cards with ease under 200%
"exact phrase"          # Exact phrase in any field
Front:hello             # Search in Front field
</code></pre>
<p>Combine with spaces (AND) or <code>OR</code>:</p>
<pre><code>deck:Japanese tag:verb
deck:Japanese OR deck:Korean
-is:suspended           # NOT suspended
</code></pre>
<div style="break-before: page; page-break-before: always;"></div>
<h1 id="mcp-server-examples"><a class="header" href="#mcp-server-examples">MCP Server Examples</a></h1>
<p>Common interactions with the ankit MCP server through Claude.</p>
<h2 id="basic-operations"><a class="header" href="#basic-operations">Basic Operations</a></h2>
<h3 id="check-connection"><a class="header" href="#check-connection">Check Connection</a></h3>
<blockquote>
<p>“Is Anki running? Can you check the AnkiConnect version?”</p>
</blockquote>
<p>Claude will call the <code>version</code> tool to verify connectivity.</p>
<h3 id="list-decks-1"><a class="header" href="#list-decks-1">List Decks</a></h3>
<blockquote>
<p>“What decks do I have in Anki?”</p>
</blockquote>
<p>Uses <code>list_decks</code> to show all available decks.</p>
<h3 id="find-cards"><a class="header" href="#find-cards">Find Cards</a></h3>
<blockquote>
<p>“How many cards are due in my Japanese deck?”</p>
</blockquote>
<p>Uses <code>find_cards</code> with query <code>deck:Japanese is:due</code>.</p>
<h2 id="study-analysis"><a class="header" href="#study-analysis">Study Analysis</a></h2>
<h3 id="study-summary"><a class="header" href="#study-summary">Study Summary</a></h3>
<blockquote>
<p>“How has my studying been going this week in my Japanese deck?”</p>
</blockquote>
<p>Uses <code>study_summary</code> with the deck name and 7 days.</p>
<h3 id="find-problem-cards"><a class="header" href="#find-problem-cards">Find Problem Cards</a></h3>
<blockquote>
<p>“Which cards in my Japanese deck am I struggling with?”</p>
</blockquote>
<p>Uses <code>find_problems</code> to identify leeches (cards with high lapse counts).</p>
<h3 id="deck-health"><a class="header" href="#deck-health">Deck Health</a></h3>
<blockquote>
<p>“Give me a health report for my vocabulary deck”</p>
</blockquote>
<p>Uses <code>deck_health_report</code> for comprehensive deck statistics including:</p>
<ul>
<li>Card counts by state (new, learning, review, suspended)</li>
<li>Average ease and interval</li>
<li>Leech count</li>
<li>Total lapses</li>
</ul>
<h2 id="card-management"><a class="header" href="#card-management">Card Management</a></h2>
<h3 id="suspend-problem-cards"><a class="header" href="#suspend-problem-cards">Suspend Problem Cards</a></h3>
<blockquote>
<p>“Suspend all cards in Japanese that have more than 8 lapses”</p>
</blockquote>
<p>Uses <code>suspend_by_criteria</code> with min_lapses set to 8.</p>
<h3 id="tag-performance"><a class="header" href="#tag-performance">Tag Performance</a></h3>
<blockquote>
<p>“Tag my struggling and mastered cards in the Japanese deck”</p>
</blockquote>
<p>Uses <code>tag_by_performance</code> to automatically tag cards based on:</p>
<ul>
<li>Struggling: Low ease factor or high lapse count</li>
<li>Mastered: High ease with many successful reviews</li>
</ul>
<h3 id="reset-progress"><a class="header" href="#reset-progress">Reset Progress</a></h3>
<blockquote>
<p>“Reset all progress in my test deck so I can start fresh”</p>
</blockquote>
<p>Uses <code>reset_deck_progress</code> to convert all cards back to new state.</p>
<h2 id="organization"><a class="header" href="#organization">Organization</a></h2>
<h3 id="clone-a-deck"><a class="header" href="#clone-a-deck">Clone a Deck</a></h3>
<blockquote>
<p>“Make a copy of my Japanese Vocabulary deck called Japanese Review”</p>
</blockquote>
<p>Uses <code>clone_deck</code> to duplicate the deck with all notes.</p>
<h3 id="merge-decks"><a class="header" href="#merge-decks">Merge Decks</a></h3>
<blockquote>
<p>“Merge my JLPT N5 and JLPT N4 decks into a single JLPT deck”</p>
</blockquote>
<p>Uses <code>merge_decks</code> with source decks and destination.</p>
<h3 id="move-by-tag"><a class="header" href="#move-by-tag">Move by Tag</a></h3>
<blockquote>
<p>“Move all notes tagged ‘difficult’ to my Review deck”</p>
</blockquote>
<p>Uses <code>move_by_tag</code> to relocate notes based on tags.</p>
<h2 id="media-management"><a class="header" href="#media-management">Media Management</a></h2>
<h3 id="audit-media"><a class="header" href="#audit-media">Audit Media</a></h3>
<blockquote>
<p>“Are there any orphaned media files in my Anki collection?”</p>
</blockquote>
<p>Uses <code>audit_media</code> to find:</p>
<ul>
<li>Orphaned files (in media folder but not referenced)</li>
<li>Missing references (referenced in notes but file missing)</li>
</ul>
<h3 id="cleanup-media"><a class="header" href="#cleanup-media">Cleanup Media</a></h3>
<blockquote>
<p>“Delete the orphaned media files (show me what will be deleted first)”</p>
</blockquote>
<p>First uses <code>cleanup_media</code> with <code>dry_run=true</code> to preview, then with <code>dry_run=false</code> to delete.</p>
<h2 id="bulk-operations"><a class="header" href="#bulk-operations">Bulk Operations</a></h2>
<h3 id="add-tags"><a class="header" href="#add-tags">Add Tags</a></h3>
<blockquote>
<p>“Add the tag ‘review-2024’ to all cards I’ve reviewed this month”</p>
</blockquote>
<p>Uses <code>find_notes</code> with <code>rated:30</code> then <code>add_tags</code>.</p>
<h3 id="import-notes"><a class="header" href="#import-notes">Import Notes</a></h3>
<blockquote>
<p>“Import these vocabulary words into my Spanish deck”</p>
</blockquote>
<p>Uses <code>import_notes</code> with duplicate handling options (skip, update, or allow).</p>
<h3 id="export-deck"><a class="header" href="#export-deck">Export Deck</a></h3>
<blockquote>
<p>“Export my Japanese deck so I can back it up”</p>
</blockquote>
<p>Uses <code>export_deck</code> to get all notes as JSON.</p>
<div style="break-before: page; page-break-before: always;"></div>
<h1 id="toml-format"><a class="header" href="#toml-format">TOML Format</a></h1>
<p>The deck builder uses TOML to define Anki decks declaratively.</p>
<h2 id="basic-structure"><a class="header" href="#basic-structure">Basic Structure</a></h2>
<pre><code class="language-toml">[package]
name = "My Deck"
version = "1.0.0"
author = "Your Name"

[[models]]
name = "Basic"
fields = ["Front", "Back"]

[[models.templates]]
name = "Card 1"
front = "{{Front}}"
back = "{{FrontSide}}&lt;hr&gt;{{Back}}"

[[decks]]
name = "My Deck"
description = "Optional description"

[[notes]]
deck = "My Deck"
model = "Basic"
tags = ["optional", "tags"]

[notes.fields]
Front = "Question"
Back = "Answer"
</code></pre>
<h2 id="package-section"><a class="header" href="#package-section">Package Section</a></h2>
<p>Required metadata about the deck package.</p>
<pre><code class="language-toml">[package]
name = "Spanish Vocabulary"  # Required: Package name
version = "1.0.0"            # Required: Semantic version
author = "Your Name"         # Optional: Author name
description = "..."          # Optional: Package description
</code></pre>
<h2 id="models-section"><a class="header" href="#models-section">Models Section</a></h2>
<p>Define note types (models) with fields and card templates.</p>
<pre><code class="language-toml">[[models]]
name = "Vocabulary"          # Required: Model name
fields = ["Word", "Definition", "Example"]  # Required: Field names
css = ".card { font-size: 20px; }"  # Optional: Styling

[[models.templates]]
name = "Word -&gt; Definition"  # Required: Template name
front = "{{Word}}"           # Required: Front template
back = "{{FrontSide}}&lt;hr&gt;{{Definition}}&lt;br&gt;&lt;i&gt;{{Example}}&lt;/i&gt;"  # Required: Back template
</code></pre>
<h3 id="multiple-templates"><a class="header" href="#multiple-templates">Multiple Templates</a></h3>
<p>A model can have multiple card templates:</p>
<pre><code class="language-toml">[[models]]
name = "Bidirectional"
fields = ["Front", "Back"]

[[models.templates]]
name = "Forward"
front = "{{Front}}"
back = "{{Back}}"

[[models.templates]]
name = "Reverse"
front = "{{Back}}"
back = "{{Front}}"
</code></pre>
<h3 id="cloze-deletion"><a class="header" href="#cloze-deletion">Cloze Deletion</a></h3>
<pre><code class="language-toml">[[models]]
name = "Cloze"
fields = ["Text", "Extra"]
cloze = true

[[models.templates]]
name = "Cloze"
front = "{{cloze:Text}}"
back = "{{cloze:Text}}&lt;br&gt;{{Extra}}"
</code></pre>
<h2 id="decks-section"><a class="header" href="#decks-section">Decks Section</a></h2>
<p>Define deck hierarchy.</p>
<pre><code class="language-toml">[[decks]]
name = "Languages::Spanish"  # Use :: for nested decks
description = "Spanish vocabulary cards"
</code></pre>
<h2 id="notes-section"><a class="header" href="#notes-section">Notes Section</a></h2>
<p>Define individual flashcards.</p>
<pre><code class="language-toml">[[notes]]
deck = "Languages::Spanish"  # Must match a deck name
model = "Vocabulary"         # Must match a model name
tags = ["beginner", "food"]  # Optional tags

[notes.fields]
Word = "el gato"
Definition = "the cat"
Example = "El gato es negro."
</code></pre>
<h3 id="multiple-notes"><a class="header" href="#multiple-notes">Multiple Notes</a></h3>
<pre><code class="language-toml">[[notes]]
deck = "Spanish"
model = "Basic"
[notes.fields]
Front = "hola"
Back = "hello"

[[notes]]
deck = "Spanish"
model = "Basic"
[notes.fields]
Front = "adios"
Back = "goodbye"
</code></pre>
<h2 id="media-section"><a class="header" href="#media-section">Media Section</a></h2>
<p>Reference media files for audio, images, and video.</p>
<pre><code class="language-toml">[[media]]
filename = "audio_hola.mp3"
path = "media/hola.mp3"  # Relative to TOML file or media_base_path
</code></pre>
<p>Then reference in note fields:</p>
<pre><code class="language-toml">[notes.fields]
Front = "hola [sound:audio_hola.mp3]"
</code></pre>
<h2 id="complete-example"><a class="header" href="#complete-example">Complete Example</a></h2>
<pre><code class="language-toml">[package]
name = "Spanish::DELE B1"
version = "1.0.0"
author = "Language Learner"

[[models]]
name = "DELE Vocabulary"
fields = ["Spanish", "English", "Example", "Audio"]
css = """
.card {
    font-family: Arial, sans-serif;
    font-size: 22px;
    text-align: center;
}
.example {
    font-style: italic;
    color: #666;
}
"""

[[models.templates]]
name = "Spanish -&gt; English"
front = "{{Spanish}}{{Audio}}"
back = """{{FrontSide}}
&lt;hr&gt;
{{English}}
&lt;div class="example"&gt;{{Example}}&lt;/div&gt;"""

[[decks]]
name = "Spanish::DELE B1"
description = "DELE B1 exam preparation vocabulary"

[[decks]]
name = "Spanish::DELE B1::Verbs"

[[notes]]
deck = "Spanish::DELE B1::Verbs"
model = "DELE Vocabulary"
tags = ["verb", "present-tense"]

[notes.fields]
Spanish = "trabajar"
English = "to work"
Example = "Trabajo en una oficina."
Audio = "[sound:trabajar.mp3]"

[[notes]]
deck = "Spanish::DELE B1"
model = "DELE Vocabulary"
tags = ["noun", "food"]

[notes.fields]
Spanish = "el pan"
English = "bread"
Example = "Compre pan en la panaderia."
</code></pre>
<div style="break-before: page; page-break-before: always;"></div>
<h1 id="apkg-generation"><a class="header" href="#apkg-generation">APKG Generation</a></h1>
<p>Generate <code>.apkg</code> files that can be imported directly into Anki.</p>
<h2 id="basic-usage"><a class="header" href="#basic-usage">Basic Usage</a></h2>
<pre><code class="language-rust ignore">use ankit_builder::DeckBuilder;

let builder = DeckBuilder::from_file("my_deck.toml")?;
builder.write_apkg("my_deck.apkg")?;</code></pre>
<h2 id="from-toml-string"><a class="header" href="#from-toml-string">From TOML String</a></h2>
<pre><code class="language-rust ignore">let toml = r#"
[package]
name = "Test"
version = "1.0.0"

[[models]]
name = "Basic"
fields = ["Front", "Back"]

[[models.templates]]
name = "Card 1"
front = "{{Front}}"
back = "{{Back}}"

[[decks]]
name = "Test"

[[notes]]
deck = "Test"
model = "Basic"
[notes.fields]
Front = "Hello"
Back = "World"
"#;

let builder = DeckBuilder::parse(toml)?;
builder.write_apkg("test.apkg")?;</code></pre>
<h2 id="with-media-files"><a class="header" href="#with-media-files">With Media Files</a></h2>
<p>When your deck includes media (audio, images):</p>
<pre><code class="language-rust ignore">let builder = DeckBuilder::from_file("deck.toml")?
    .media_base_path("./media");  // Directory containing media files

builder.write_apkg("deck.apkg")?;</code></pre>
<p>The TOML references media like:</p>
<pre><code class="language-toml">[[media]]
filename = "pronunciation.mp3"
path = "audio/pronunciation.mp3"  # Relative to media_base_path
</code></pre>
<h2 id="how-apkg-files-work"><a class="header" href="#how-apkg-files-work">How APKG Files Work</a></h2>
<p>An <code>.apkg</code> file is a ZIP archive containing:</p>
<ol>
<li>
<p><code>collection.anki2</code> - SQLite database with:</p>
<ul>
<li>Notes (the actual flashcard content)</li>
<li>Cards (generated from notes via templates)</li>
<li>Models (note types with field definitions)</li>
<li>Decks (organizational structure)</li>
</ul>
</li>
<li>
<p><code>media</code> - Directory of media files</p>
</li>
<li>
<p><code>media</code> (JSON file) - Media file manifest</p>
</li>
</ol>
<p>The builder generates Anki’s schema v11 format for maximum compatibility.</p>
<h2 id="id-generation"><a class="header" href="#id-generation">ID Generation</a></h2>
<p>The builder generates deterministic IDs based on content:</p>
<ul>
<li><strong>Model IDs</strong>: Hash of model name</li>
<li><strong>Deck IDs</strong>: Hash of deck name</li>
<li><strong>Note IDs</strong>: Hash of note content (fields + deck + model)</li>
<li><strong>Card IDs</strong>: Derived from note ID + template index</li>
</ul>
<p>This means rebuilding the same TOML produces identical IDs, which helps with:</p>
<ul>
<li>Updating existing decks</li>
<li>Version control friendliness</li>
<li>Predictable behavior</li>
</ul>
<h2 id="importing-the-apkg"><a class="header" href="#importing-the-apkg">Importing the APKG</a></h2>
<p>In Anki:</p>
<ol>
<li>File &gt; Import</li>
<li>Select the <code>.apkg</code> file</li>
<li>Choose import options:
<ul>
<li>Update existing notes if first field matches</li>
<li>Import as new notes</li>
<li>Skip duplicates</li>
</ul>
</li>
</ol>
<h2 id="command-line-planned"><a class="header" href="#command-line-planned">Command Line (Planned)</a></h2>
<p>Future CLI support:</p>
<pre><code class="language-bash"># Build APKG from TOML
ankit build deck.toml -o deck.apkg

# Build with media directory
ankit build deck.toml --media ./assets -o deck.apkg
</code></pre>
<h2 id="limitations"><a class="header" href="#limitations">Limitations</a></h2>
<ul>
<li>Models must be fully defined in TOML (no inheritance)</li>
<li>Media files must exist at build time</li>
<li>Scheduling data (due dates, intervals) is not preserved</li>
<li>Study progress starts fresh on import</li>
</ul>
<div style="break-before: page; page-break-before: always;"></div>
<h1 id="ankiconnect-import"><a class="header" href="#ankiconnect-import">AnkiConnect Import</a></h1>
<p>Import deck definitions directly into a running Anki instance.</p>
<h2 id="basic-usage-1"><a class="header" href="#basic-usage-1">Basic Usage</a></h2>
<pre><code class="language-rust ignore">use ankit_builder::DeckBuilder;

let builder = DeckBuilder::from_file("deck.toml")?;
let result = builder.import_connect().await?;

println!("Decks created: {}", result.decks_created);
println!("Notes created: {}", result.notes_created);
println!("Notes skipped: {}", result.notes_skipped);</code></pre>
<h2 id="requirements-1"><a class="header" href="#requirements-1">Requirements</a></h2>
<p>Unlike APKG generation, AnkiConnect import requires:</p>
<ol>
<li><strong>Anki running</strong> with AnkiConnect add-on</li>
<li><strong>Models must already exist</strong> in Anki</li>
</ol>
<p>The builder will:</p>
<ul>
<li>Create missing decks automatically</li>
<li>Fail if a referenced model doesn’t exist</li>
</ul>
<h2 id="validate-before-import"><a class="header" href="#validate-before-import">Validate Before Import</a></h2>
<p>Check prerequisites before attempting import:</p>
<pre><code class="language-rust ignore">use ankit_builder::{ConnectImporter, DeckDefinition};

let definition = DeckDefinition::from_file("deck.toml")?;
let importer = ConnectImporter::new(definition);

// Check for missing models
let missing_models = importer.validate_models().await?;
if !missing_models.is_empty() {
    eprintln!("Missing models in Anki:");
    for model in &amp;missing_models {
        eprintln!("  - {}", model);
    }
    eprintln!("Please create these note types manually first.");
    return Ok(());
}

// Check which decks will be created
let missing_decks = importer.validate_decks().await?;
if !missing_decks.is_empty() {
    println!("Will create {} decks", missing_decks.len());
}

// Proceed with import
let result = importer.import().await?;</code></pre>
<h2 id="batch-import"><a class="header" href="#batch-import">Batch Import</a></h2>
<p>For large decks, batch import is more efficient:</p>
<pre><code class="language-rust ignore">let result = builder.import_connect_batch().await?;</code></pre>
<p>This uses a single API call to add all notes, versus one call per note.</p>
<p>Trade-offs:</p>
<ul>
<li><strong>Single import</strong>: Better error tracking (know exactly which note failed)</li>
<li><strong>Batch import</strong>: Faster for large decks (one API call)</li>
</ul>
<h2 id="handling-duplicates"><a class="header" href="#handling-duplicates">Handling Duplicates</a></h2>
<p>By default, AnkiConnect rejects duplicate notes. The import result tracks skipped notes:</p>
<pre><code class="language-rust ignore">let result = builder.import_connect().await?;

if !result.errors.is_empty() {
    println!("Some notes were skipped:");
    for (index, error) in &amp;result.errors {
        println!("  Note {}: {}", index, error);
    }
}</code></pre>
<h2 id="custom-client-configuration"><a class="header" href="#custom-client-configuration">Custom Client Configuration</a></h2>
<p>Use a custom AnkiConnect client:</p>
<pre><code class="language-rust ignore">use ankit_builder::{ConnectImporter, DeckDefinition};
use ankit::AnkiClient;

let client = AnkiClient::builder()
    .url("http://localhost:8765")
    .api_key("your-api-key")
    .build();

let definition = DeckDefinition::from_file("deck.toml")?;
let importer = ConnectImporter::with_client(definition, client);
let result = importer.import().await?;</code></pre>
<h2 id="when-to-use-each-method"><a class="header" href="#when-to-use-each-method">When to Use Each Method</a></h2>
<div class="table-wrapper">
<table>
<thead>
<tr><th>Scenario</th><th>Method</th></tr>
</thead>
<tbody>
<tr><td>Share deck with others</td><td>APKG</td></tr>
<tr><td>Backup deck</td><td>APKG</td></tr>
<tr><td>Quick iteration during development</td><td>AnkiConnect</td></tr>
<tr><td>CI/CD pipeline</td><td>AnkiConnect</td></tr>
<tr><td>No Anki running</td><td>APKG</td></tr>
<tr><td>Preserve models exactly</td><td>APKG</td></tr>
<tr><td>Use existing models</td><td>AnkiConnect</td></tr>
</tbody>
</table>
</div>
<h2 id="error-handling-1"><a class="header" href="#error-handling-1">Error Handling</a></h2>
<pre><code class="language-rust ignore">use ankit_builder::{DeckBuilder, Error};

match builder.import_connect().await {
    Ok(result) =&gt; {
        println!("Success: {} notes created", result.notes_created);
    }
    Err(Error::ModelNotFound(name)) =&gt; {
        eprintln!("Model '{}' not found in Anki", name);
    }
    Err(Error::Ankit(ankit::Error::ConnectionRefused)) =&gt; {
        eprintln!("Cannot connect to Anki. Is it running?");
    }
    Err(e) =&gt; {
        eprintln!("Import failed: {}", e);
    }
}</code></pre>
<div style="break-before: page; page-break-before: always;"></div>
<h1 id="import-workflow"><a class="header" href="#import-workflow">Import Workflow</a></h1>
<p>Patterns for importing notes into Anki programmatically.</p>
<h2 id="simple-note-import"><a class="header" href="#simple-note-import">Simple Note Import</a></h2>
<pre><code class="language-rust ignore">use ankit::{AnkiClient, NoteBuilder};

let client = AnkiClient::new();

let note = NoteBuilder::new("Vocabulary", "Basic")
    .field("Front", "hello")
    .field("Back", "world")
    .tag("imported")
    .build();

let note_id = client.notes().add(note).await?;</code></pre>
<h2 id="bulk-import-with-engine"><a class="header" href="#bulk-import-with-engine">Bulk Import with Engine</a></h2>
<pre><code class="language-rust ignore">use ankit_engine::Engine;
use ankit_engine::import::OnDuplicate;

let engine = Engine::new();

let notes = vec![
    NoteBuilder::new("Vocabulary", "Basic")
        .field("Front", "one").field("Back", "1").build(),
    NoteBuilder::new("Vocabulary", "Basic")
        .field("Front", "two").field("Back", "2").build(),
    NoteBuilder::new("Vocabulary", "Basic")
        .field("Front", "three").field("Back", "3").build(),
];

let report = engine.import()
    .notes(&amp;notes, OnDuplicate::Skip)
    .await?;

println!("Created: {}", report.created);
println!("Skipped: {}", report.skipped);
println!("Updated: {}", report.updated);</code></pre>
<h2 id="duplicate-handling-options"><a class="header" href="#duplicate-handling-options">Duplicate Handling Options</a></h2>
<pre><code class="language-rust ignore">use ankit_engine::import::OnDuplicate;

// Skip duplicates (default)
OnDuplicate::Skip

// Update existing notes with new field values
OnDuplicate::Update

// Allow duplicates (creates new notes)
OnDuplicate::Allow</code></pre>
<h2 id="import-from-csv"><a class="header" href="#import-from-csv">Import from CSV</a></h2>
<pre><code class="language-rust ignore">use std::fs::File;
use csv::Reader;

let mut reader = Reader::from_path("vocabulary.csv")?;

let mut notes = Vec::new();
for result in reader.records() {
    let record = result?;
    let note = NoteBuilder::new("Vocabulary", "Basic")
        .field("Front", &amp;record[0])
        .field("Back", &amp;record[1])
        .build();
    notes.push(note);
}

let report = engine.import()
    .notes(&amp;notes, OnDuplicate::Skip)
    .await?;</code></pre>
<h2 id="import-from-json"><a class="header" href="#import-from-json">Import from JSON</a></h2>
<pre><code class="language-rust ignore">use serde::Deserialize;

#[derive(Deserialize)]
struct VocabEntry {
    word: String,
    definition: String,
    tags: Vec&lt;String&gt;,
}

let json_data = std::fs::read_to_string("vocabulary.json")?;
let entries: Vec&lt;VocabEntry&gt; = serde_json::from_str(&amp;json_data)?;

let notes: Vec&lt;_&gt; = entries.iter().map(|e| {
    let mut builder = NoteBuilder::new("Vocabulary", "Basic")
        .field("Front", &amp;e.word)
        .field("Back", &amp;e.definition);
    for tag in &amp;e.tags {
        builder = builder.tag(tag);
    }
    builder.build()
}).collect();

let report = engine.import()
    .notes(&amp;notes, OnDuplicate::Skip)
    .await?;</code></pre>
<h2 id="validate-before-import-1"><a class="header" href="#validate-before-import-1">Validate Before Import</a></h2>
<pre><code class="language-rust ignore">// Check if all notes can be added
let can_add = client.notes().can_add(&amp;notes).await?;

let valid_notes: Vec&lt;_&gt; = notes.into_iter()
    .zip(can_add.iter())
    .filter(|(_, &amp;can_add)| can_add)
    .map(|(note, _)| note)
    .collect();

println!("{} of {} notes are valid", valid_notes.len(), can_add.len());</code></pre>
<h2 id="error-handling-for-large-imports"><a class="header" href="#error-handling-for-large-imports">Error Handling for Large Imports</a></h2>
<pre><code class="language-rust ignore">let mut created = 0;
let mut errors = Vec::new();

for (i, note) in notes.into_iter().enumerate() {
    match client.notes().add(note).await {
        Ok(_) =&gt; created += 1,
        Err(e) =&gt; errors.push((i, e.to_string())),
    }
}

println!("Created {} notes", created);
if !errors.is_empty() {
    println!("Errors:");
    for (i, err) in &amp;errors {
        println!("  Note {}: {}", i, err);
    }
}</code></pre>
<h2 id="import-with-media"><a class="header" href="#import-with-media">Import with Media</a></h2>
<pre><code class="language-rust ignore">use ankit::{NoteBuilder, MediaAttachment};

let note = NoteBuilder::new("Vocabulary", "Basic")
    .field("Front", "pronunciation")
    .field("Back", "the way a word is spoken")
    .audio(MediaAttachment {
        url: Some("https://example.com/pronunciation.mp3".to_string()),
        data: None,
        path: None,
        filename: "pronunciation.mp3".to_string(),
        fields: vec!["Front".to_string()],
        skip_hash: None,
    })
    .build();

client.notes().add(note).await?;</code></pre>
<div style="break-before: page; page-break-before: always;"></div>
<h1 id="deck-organization"><a class="header" href="#deck-organization">Deck Organization</a></h1>
<p>Patterns for organizing and restructuring Anki decks.</p>
<h2 id="clone-a-deck-1"><a class="header" href="#clone-a-deck-1">Clone a Deck</a></h2>
<p>Create a copy of a deck for experimentation or backup:</p>
<pre><code class="language-rust ignore">use ankit_engine::Engine;

let engine = Engine::new();

let report = engine.organize()
    .clone_deck("Japanese::N5", "Japanese::N5-Copy")
    .await?;

println!("Cloned {} notes", report.notes_cloned);</code></pre>
<h2 id="merge-decks-1"><a class="header" href="#merge-decks-1">Merge Decks</a></h2>
<p>Combine multiple decks into one:</p>
<pre><code class="language-rust ignore">let sources = vec![
    "Japanese::N5",
    "Japanese::N4",
    "Japanese::N3",
];

let report = engine.organize()
    .merge_decks(&amp;sources, "Japanese::All")
    .await?;

println!("Merged {} notes from {} decks",
    report.notes_moved, report.decks_merged);</code></pre>
<h2 id="move-notes-by-tag"><a class="header" href="#move-notes-by-tag">Move Notes by Tag</a></h2>
<p>Reorganize notes based on tags:</p>
<pre><code class="language-rust ignore">// Move all difficult cards to a review deck
let report = engine.organize()
    .move_by_tag("difficult", "Review::Difficult")
    .await?;

println!("Moved {} notes", report.notes_moved);</code></pre>
<h2 id="bulk-tag-operations"><a class="header" href="#bulk-tag-operations">Bulk Tag Operations</a></h2>
<p>Add tags to multiple notes:</p>
<pre><code class="language-rust ignore">// Find all notes in a deck
let note_ids = engine.client().notes()
    .find("deck:Japanese")
    .await?;

// Add a tag to all of them
engine.client().notes()
    .add_tags(&amp;note_ids, "reviewed-2024")
    .await?;</code></pre>
<p>Remove tags:</p>
<pre><code class="language-rust ignore">engine.client().notes()
    .remove_tags(&amp;note_ids, "old-tag")
    .await?;</code></pre>
<p>Replace tags globally:</p>
<pre><code class="language-rust ignore">engine.client().notes()
    .replace_tags_all("typo-tag", "correct-tag")
    .await?;</code></pre>
<h2 id="clean-up-unused-tags"><a class="header" href="#clean-up-unused-tags">Clean Up Unused Tags</a></h2>
<p>Remove tags that aren’t used by any notes:</p>
<pre><code class="language-rust ignore">engine.client().notes()
    .clear_unused_tags()
    .await?;</code></pre>
<h2 id="create-deck-hierarchy"><a class="header" href="#create-deck-hierarchy">Create Deck Hierarchy</a></h2>
<pre><code class="language-rust ignore">// Anki creates parent decks automatically
engine.client().decks()
    .create("Languages::Japanese::Vocabulary::N5")
    .await?;

// This creates:
// - Languages
// - Languages::Japanese
// - Languages::Japanese::Vocabulary
// - Languages::Japanese::Vocabulary::N5</code></pre>
<h2 id="delete-empty-decks"><a class="header" href="#delete-empty-decks">Delete Empty Decks</a></h2>
<pre><code class="language-rust ignore">// Get all decks
let decks = engine.client().decks().names().await?;

for deck in decks {
    // Check if deck has cards
    let query = format!("deck:\"{}\"", deck);
    let cards = engine.client().cards().find(&amp;query).await?;

    if cards.is_empty() {
        println!("Deleting empty deck: {}", deck);
        engine.client().decks()
            .delete(&amp;[deck.as_str()], false)
            .await?;
    }
}</code></pre>
<h2 id="performance-based-organization"><a class="header" href="#performance-based-organization">Performance-Based Organization</a></h2>
<p>Tag cards based on how well you know them:</p>
<pre><code class="language-rust ignore">use ankit_engine::progress::PerformanceCriteria;

let report = engine.progress().tag_by_performance(
    "deck:Japanese",
    PerformanceCriteria::default(),
    "struggling",
    "mastered",
).await?;

println!("Tagged {} struggling, {} mastered",
    report.struggling_count, report.mastered_count);</code></pre>
<p>Then move them:</p>
<pre><code class="language-rust ignore">// Move struggling cards to a separate deck
engine.organize()
    .move_by_tag("struggling", "Japanese::Review")
    .await?;</code></pre>
<h2 id="deck-statistics"><a class="header" href="#deck-statistics">Deck Statistics</a></h2>
<p>Get an overview of your decks:</p>
<pre><code class="language-rust ignore">let deck_names = engine.client().decks().names().await?;

for name in &amp;deck_names {
    let health = engine.progress().deck_health(name).await?;

    println!("{}:", name);
    println!("  Total: {}", health.total_cards);
    println!("  New: {}", health.new_cards);
    println!("  Learning: {}", health.learning_cards);
    println!("  Review: {}", health.review_cards);
    println!("  Suspended: {}", health.suspended_cards);
    println!("  Leeches: {}", health.leech_count);
    println!();
}</code></pre>
<div style="break-before: page; page-break-before: always;"></div>
<h1 id="media-management-1"><a class="header" href="#media-management-1">Media Management</a></h1>
<p>Patterns for managing audio, images, and other media in Anki.</p>
<h2 id="audit-media-files"><a class="header" href="#audit-media-files">Audit Media Files</a></h2>
<p>Find orphaned files and missing references:</p>
<pre><code class="language-rust ignore">use ankit_engine::Engine;

let engine = Engine::new();

let report = engine.media().audit().await?;

println!("Orphaned files (in folder but not used):");
for file in &amp;report.orphaned {
    println!("  {}", file);
}

println!("\nMissing files (referenced but not found):");
for file in &amp;report.missing {
    println!("  {}", file);
}</code></pre>
<h2 id="clean-up-orphaned-media"><a class="header" href="#clean-up-orphaned-media">Clean Up Orphaned Media</a></h2>
<p>Preview what would be deleted:</p>
<pre><code class="language-rust ignore">let preview = engine.media()
    .cleanup(true)  // dry_run = true
    .await?;

println!("Would delete {} files:", preview.deleted.len());
for file in &amp;preview.deleted {
    println!("  {}", file);
}</code></pre>
<p>Actually delete orphaned files:</p>
<pre><code class="language-rust ignore">let result = engine.media()
    .cleanup(false)  // dry_run = false
    .await?;

println!("Deleted {} orphaned files", result.deleted.len());</code></pre>
<h2 id="store-media-files"><a class="header" href="#store-media-files">Store Media Files</a></h2>
<p>Store a file from various sources:</p>
<pre><code class="language-rust ignore">use ankit::StoreMediaParams;

// From base64
let params = StoreMediaParams::from_base64(
    "test.txt",
    "SGVsbG8gV29ybGQ=",  // "Hello World"
);
let filename = engine.client().media().store(params).await?;

// From URL
let params = StoreMediaParams::from_url(
    "image.png",
    "https://example.com/image.png",
);
let filename = engine.client().media().store(params).await?;

// From local file
let params = StoreMediaParams::from_path(
    "audio.mp3",
    "/path/to/audio.mp3",
);
let filename = engine.client().media().store(params).await?;</code></pre>
<h2 id="list-media-files"><a class="header" href="#list-media-files">List Media Files</a></h2>
<pre><code class="language-rust ignore">// List all media files
let all_files = engine.client().media().list("*").await?;

// List by extension
let mp3_files = engine.client().media().list("*.mp3").await?;
let images = engine.client().media().list("*.{png,jpg,gif}").await?;

// List by prefix
let prefixed = engine.client().media().list("japanese_*").await?;</code></pre>
<h2 id="get-media-directory-path"><a class="header" href="#get-media-directory-path">Get Media Directory Path</a></h2>
<pre><code class="language-rust ignore">let media_dir = engine.client().media().directory().await?;
println!("Media stored at: {}", media_dir);</code></pre>
<h2 id="retrieve-media-content"><a class="header" href="#retrieve-media-content">Retrieve Media Content</a></h2>
<pre><code class="language-rust ignore">// Get file content as base64
let base64_data = engine.client().media()
    .retrieve("audio.mp3")
    .await?;

// Decode if needed
use base64::{Engine as _, engine::general_purpose};
let bytes = general_purpose::STANDARD.decode(&amp;base64_data)?;</code></pre>
<h2 id="delete-media-files"><a class="header" href="#delete-media-files">Delete Media Files</a></h2>
<pre><code class="language-rust ignore">engine.client().media()
    .delete("old_audio.mp3")
    .await?;</code></pre>
<h2 id="add-notes-with-media"><a class="header" href="#add-notes-with-media">Add Notes with Media</a></h2>
<h3 id="audio"><a class="header" href="#audio">Audio</a></h3>
<pre><code class="language-rust ignore">use ankit::{NoteBuilder, MediaAttachment};

let note = NoteBuilder::new("Vocabulary", "Basic")
    .field("Front", "hello")
    .field("Back", "world")
    .audio(MediaAttachment {
        url: Some("https://example.com/hello.mp3".to_string()),
        filename: "hello.mp3".to_string(),
        fields: vec!["Front".to_string()],  // Insert into Front field
        ..Default::default()
    })
    .build();

engine.client().notes().add(note).await?;</code></pre>
<h3 id="images"><a class="header" href="#images">Images</a></h3>
<pre><code class="language-rust ignore">let note = NoteBuilder::new("Geography", "Basic")
    .field("Front", "What country is this?")
    .field("Back", "France")
    .picture(MediaAttachment {
        path: Some("/path/to/france_map.png".to_string()),
        filename: "france_map.png".to_string(),
        fields: vec!["Front".to_string()],
        ..Default::default()
    })
    .build();</code></pre>
<h3 id="video"><a class="header" href="#video">Video</a></h3>
<pre><code class="language-rust ignore">let note = NoteBuilder::new("Language", "Basic")
    .field("Front", "Watch the gesture")
    .field("Back", "Hello")
    .video(MediaAttachment {
        url: Some("https://example.com/gesture.mp4".to_string()),
        filename: "gesture.mp4".to_string(),
        fields: vec!["Front".to_string()],
        ..Default::default()
    })
    .build();</code></pre>
<h2 id="bulk-media-check"><a class="header" href="#bulk-media-check">Bulk Media Check</a></h2>
<p>Find notes with missing media:</p>
<pre><code class="language-rust ignore">let note_ids = engine.client().notes()
    .find("deck:Vocabulary")
    .await?;

let notes = engine.client().notes().info(&amp;note_ids).await?;
let media_files: std::collections::HashSet&lt;_&gt; =
    engine.client().media().list("*").await?.into_iter().collect();

for note in notes {
    for (_, field) in &amp;note.fields {
        // Check for [sound:...] references
        if field.value.contains("[sound:") {
            // Extract filename and check if it exists
            // ...
        }
        // Check for &lt;img src="..."&gt; references
        if field.value.contains("&lt;img") {
            // ...
        }
    }
}</code></pre>
<div style="break-before: page; page-break-before: always;"></div>
<h1 id="api-reference"><a class="header" href="#api-reference">API Reference</a></h1>
<p>Full API documentation is available on docs.rs:</p>
<ul>
<li><a href="https://docs.rs/ankit">ankit</a> - Core AnkiConnect client</li>
<li><a href="https://docs.rs/ankit-engine">ankit-engine</a> - High-level workflows</li>
<li><a href="https://docs.rs/ankit-builder">ankit-builder</a> - TOML deck builder</li>
</ul>
<h2 id="quick-reference"><a class="header" href="#quick-reference">Quick Reference</a></h2>
<h3 id="ankiclient-methods"><a class="header" href="#ankiclient-methods">AnkiClient Methods</a></h3>
<pre><code class="language-rust ignore">let client = AnkiClient::new();

// Decks
client.decks().names()
client.decks().create(name)
client.decks().delete(names, cards_too)
client.decks().config(name)
client.decks().stats(names)

// Notes
client.notes().add(note)
client.notes().add_many(notes)
client.notes().find(query)
client.notes().info(note_ids)
client.notes().update_fields(note_id, fields)
client.notes().delete(note_ids)
client.notes().add_tags(note_ids, tags)
client.notes().remove_tags(note_ids, tags)

// Cards
client.cards().find(query)
client.cards().info(card_ids)
client.cards().suspend(card_ids)
client.cards().unsuspend(card_ids)
client.cards().forget(card_ids)
client.cards().get_ease(card_ids)
client.cards().set_ease(card_ids, ease_factors)

// Models
client.models().names()
client.models().field_names(model_name)
client.models().create(params)
client.models().templates(model_name)

// Media
client.media().store(params)
client.media().retrieve(filename)
client.media().list(pattern)
client.media().delete(filename)

// Statistics
client.statistics().cards_reviewed_today()
client.statistics().cards_reviewed_by_day()

// Misc
client.misc().version()
client.misc().sync()</code></pre>
<h3 id="engine-methods"><a class="header" href="#engine-methods">Engine Methods</a></h3>
<pre><code class="language-rust ignore">let engine = Engine::new();

// Import
engine.import().notes(notes, on_duplicate)
engine.import().validate(notes)

// Export
engine.export().deck(deck_name)
engine.export().reviews(query)

// Organize
engine.organize().clone_deck(source, dest)
engine.organize().merge_decks(sources, dest)
engine.organize().move_by_tag(tag, dest)

// Analyze
engine.analyze().study_summary(deck, days)
engine.analyze().retention_stats(deck)
engine.analyze().find_problems(query, criteria)

// Progress
engine.progress().reset_deck(deck)
engine.progress().tag_by_performance(query, criteria, struggling_tag, mastered_tag)
engine.progress().suspend_by_criteria(query, criteria)
engine.progress().deck_health(deck)

// Media
engine.media().audit()
engine.media().cleanup(dry_run)

// Enrich
engine.enrich().find_candidates(query, field)
engine.enrich().update_note(note_id, field, value)

// Deduplicate
engine.deduplicate().find(query, key_field)
engine.deduplicate().remove(query, key_field, keep)</code></pre>
<h3 id="deckbuilder-methods"><a class="header" href="#deckbuilder-methods">DeckBuilder Methods</a></h3>
<pre><code class="language-rust ignore">let builder = DeckBuilder::from_file(path)?;
let builder = DeckBuilder::parse(toml_str)?;

builder.definition()
builder.media_base_path(path)
builder.write_apkg(path)?
builder.import_connect().await?
builder.import_connect_batch().await?</code></pre>
<h2 id="common-types"><a class="header" href="#common-types">Common Types</a></h2>
<h3 id="note"><a class="header" href="#note">Note</a></h3>
<pre><code class="language-rust ignore">let note = NoteBuilder::new(deck, model)
    .field(name, value)
    .tag(tag)
    .tags(vec![...])
    .audio(attachment)
    .picture(attachment)
    .video(attachment)
    .allow_duplicate(bool)
    .build();</code></pre>
<h3 id="query-syntax-1"><a class="header" href="#query-syntax-1">Query Syntax</a></h3>
<pre><code>deck:Name           # Deck filter
tag:name            # Tag filter
is:due              # Due cards
is:new              # New cards
is:review           # Review cards
is:suspended        # Suspended cards
rated:N             # Reviewed in last N days
prop:lapses&gt;=N      # Property comparisons
prop:ease&lt;N
"exact phrase"      # Phrase search
field:value         # Field search
-filter             # NOT
filter1 filter2     # AND
filter1 OR filter2  # OR
</code></pre>

                    </main>

                    <nav class="nav-wrapper" aria-label="Page navigation">
                        <!-- Mobile navigation buttons -->


                        <div style="clear: both"></div>
                    </nav>
                </div>
            </div>

            <nav class="nav-wide-wrapper" aria-label="Page navigation">

            </nav>

        </div>

        <template id=fa-eye><span class=fa-svg><svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 576 512"><!--! Font Awesome Free 6.2.0 by @fontawesome - https://fontawesome.com License - https://fontawesome.com/license/free (Icons: CC BY 4.0, Fonts: SIL OFL 1.1, Code: MIT License) Copyright 2022 Fonticons, Inc. --><path d="M288 32c-80.8 0-145.5 36.8-192.6 80.6C48.6 156 17.3 208 2.5 243.7c-3.3 7.9-3.3 16.7 0 24.6C17.3 304 48.6 356 95.4 399.4C142.5 443.2 207.2 480 288 480s145.5-36.8 192.6-80.6c46.8-43.5 78.1-95.4 93-131.1c3.3-7.9 3.3-16.7 0-24.6c-14.9-35.7-46.2-87.7-93-131.1C433.5 68.8 368.8 32 288 32zM432 256c0 79.5-64.5 144-144 144s-144-64.5-144-144s64.5-144 144-144s144 64.5 144 144zM288 192c0 35.3-28.7 64-64 64c-11.5 0-22.3-3-31.6-8.4c-.2 2.8-.4 5.5-.4 8.4c0 53 43 96 96 96s96-43 96-96s-43-96-96-96c-2.8 0-5.6 .1-8.4 .4c5.3 9.3 8.4 20.1 8.4 31.6z"/></svg></span></template>
        <template id=fa-eye-slash><span class=fa-svg><svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 640 512"><!--! Font Awesome Free 6.2.0 by @fontawesome - https://fontawesome.com License - https://fontawesome.com/license/free (Icons: CC BY 4.0, Fonts: SIL OFL 1.1, Code: MIT License) Copyright 2022 Fonticons, Inc. --><path d="M38.8 5.1C28.4-3.1 13.3-1.2 5.1 9.2S-1.2 34.7 9.2 42.9l592 464c10.4 8.2 25.5 6.3 33.7-4.1s6.3-25.5-4.1-33.7L525.6 386.7c39.6-40.6 66.4-86.1 79.9-118.4c3.3-7.9 3.3-16.7 0-24.6c-14.9-35.7-46.2-87.7-93-131.1C465.5 68.8 400.8 32 320 32c-68.2 0-125 26.3-169.3 60.8L38.8 5.1zM223.1 149.5C248.6 126.2 282.7 112 320 112c79.5 0 144 64.5 144 144c0 24.9-6.3 48.3-17.4 68.7L408 294.5c5.2-11.8 8-24.8 8-38.5c0-53-43-96-96-96c-2.8 0-5.6 .1-8.4 .4c5.3 9.3 8.4 20.1 8.4 31.6c0 10.2-2.4 19.8-6.6 28.3l-90.3-70.8zm223.1 298L373 389.9c-16.4 6.5-34.3 10.1-53 10.1c-79.5 0-144-64.5-144-144c0-6.9 .5-13.6 1.4-20.2L83.1 161.5C60.3 191.2 44 220.8 34.5 243.7c-3.3 7.9-3.3 16.7 0 24.6c14.9 35.7 46.2 87.7 93 131.1C174.5 443.2 239.2 480 320 480c47.8 0 89.9-12.9 126.2-32.5z"/></svg></span></template>
        <template id=fa-copy><span class=fa-svg><svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 512 512"><!--! Font Awesome Free 6.2.0 by @fontawesome - https://fontawesome.com License - https://fontawesome.com/license/free (Icons: CC BY 4.0, Fonts: SIL OFL 1.1, Code: MIT License) Copyright 2022 Fonticons, Inc. --><path d="M502.6 70.63l-61.25-61.25C435.4 3.371 427.2 0 418.7 0H255.1c-35.35 0-64 28.66-64 64l.0195 256C192 355.4 220.7 384 256 384h192c35.2 0 64-28.8 64-64V93.25C512 84.77 508.6 76.63 502.6 70.63zM464 320c0 8.836-7.164 16-16 16H255.1c-8.838 0-16-7.164-16-16L239.1 64.13c0-8.836 7.164-16 16-16h128L384 96c0 17.67 14.33 32 32 32h47.1V320zM272 448c0 8.836-7.164 16-16 16H63.1c-8.838 0-16-7.164-16-16L47.98 192.1c0-8.836 7.164-16 16-16H160V128H63.99c-35.35 0-64 28.65-64 64l.0098 256C.002 483.3 28.66 512 64 512h192c35.2 0 64-28.8 64-64v-32h-47.1L272 448z"/></svg></span></template>
        <template id=fa-play><span class=fa-svg><svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 384 512"><!--! Font Awesome Free 6.2.0 by @fontawesome - https://fontawesome.com License - https://fontawesome.com/license/free (Icons: CC BY 4.0, Fonts: SIL OFL 1.1, Code: MIT License) Copyright 2022 Fonticons, Inc. --><path d="M73 39c-14.8-9.1-33.4-9.4-48.5-.9S0 62.6 0 80V432c0 17.4 9.4 33.4 24.5 41.9s33.7 8.1 48.5-.9L361 297c14.3-8.7 23-24.2 23-41s-8.7-32.2-23-41L73 39z"/></svg></span></template>
        <template id=fa-clock-rotate-left><span class=fa-svg><svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 512 512"><!--! Font Awesome Free 6.2.0 by @fontawesome - https://fontawesome.com License - https://fontawesome.com/license/free (Icons: CC BY 4.0, Fonts: SIL OFL 1.1, Code: MIT License) Copyright 2022 Fonticons, Inc. --><path d="M75 75L41 41C25.9 25.9 0 36.6 0 57.9V168c0 13.3 10.7 24 24 24H134.1c21.4 0 32.1-25.9 17-41l-30.8-30.8C155 85.5 203 64 256 64c106 0 192 86 192 192s-86 192-192 192c-40.8 0-78.6-12.7-109.7-34.4c-14.5-10.1-34.4-6.6-44.6 7.9s-6.6 34.4 7.9 44.6C151.2 495 201.7 512 256 512c141.4 0 256-114.6 256-256S397.4 0 256 0C185.3 0 121.3 28.7 75 75zm181 53c-13.3 0-24 10.7-24 24V256c0 6.4 2.5 12.5 7 17l72 72c9.4 9.4 24.6 9.4 33.9 0s9.4-24.6 0-33.9l-65-65V152c0-13.3-10.7-24-24-24z"/></svg></span></template>

        <!-- Livereload script (if served using the cli tool) -->
        <script>
            const wsProtocol = location.protocol === 'https:' ? 'wss:' : 'ws:';
            const wsAddress = wsProtocol + "//" + location.host + "/" + "__livereload";
            const socket = new WebSocket(wsAddress);
            socket.onmessage = function (event) {
                if (event.data === "reload") {
                    socket.close();
                    location.reload();
                }
            };

            window.onbeforeunload = function() {
                socket.close();
            }
        </script>


        <script>
            window.playground_copyable = true;
        </script>


        <script src="elasticlunr-ef4e11c1.min.js"></script>
        <script src="mark-09e88c2c.min.js"></script>
        <script src="searcher-c2a407aa.js"></script>

        <script src="clipboard-1626706a.min.js"></script>
        <script src="highlight-abc7f01d.js"></script>
        <script src="book-a0b12cfe.js"></script>

        <!-- Custom JS scripts -->

        <script>
        window.addEventListener('load', function() {
            window.setTimeout(window.print, 100);
        });
        </script>


    </div>
    </body>
</html>
